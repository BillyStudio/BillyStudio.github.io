<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang="en">
<head><meta name="generator" content="Hexo 3.8.0">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">






















<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">

<link rel="stylesheet" href="/css/main.css?v=7.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.2.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.2.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.2.0">


  <link rel="mask-icon" href="/images/logo.svg?v=7.2.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '7.2.0',
    sidebar: {"position":"right","display":"hide","offset":12,"onmobile":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <meta name="description" content="Basic experiment docs">
<meta name="keywords" content="Smart Contracts,Blockchain,Shellchain">
<meta property="og:type" content="article">
<meta property="og:title" content="Shellchain experiment">
<meta property="og:url" content="http://BillyStudio.github.io/2018/09/08/multichain-experiment/index.html">
<meta property="og:site_name" content="Shane&#39;s Blog">
<meta property="og:description" content="Basic experiment docs">
<meta property="og:locale" content="en">
<meta property="og:image" content="http://billystudio.github.io/2018/09/08/multichain-experiment/1.png">
<meta property="og:image" content="http://billystudio.github.io/2018/09/08/multichain-experiment/2.png">
<meta property="og:image" content="http://billystudio.github.io/2018/09/08/multichain-experiment/3.png">
<meta property="og:image" content="http://billystudio.github.io/2018/09/08/multichain-experiment/4.png">
<meta property="og:image" content="http://billystudio.github.io/2018/09/08/multichain-experiment/5.png">
<meta property="og:image" content="http://billystudio.github.io/2018/09/08/multichain-experiment/6.png">
<meta property="og:image" content="http://billystudio.github.io/2018/09/08/multichain-experiment/7.png">
<meta property="og:image" content="http://billystudio.github.io/2018/09/08/multichain-experiment/8.png">
<meta property="og:image" content="http://billystudio.github.io/2018/09/08/multichain-experiment/9.png">
<meta property="og:image" content="http://billystudio.github.io/2018/09/08/multichain-experiment/getnewaddress.png">
<meta property="og:image" content="http://billystudio.github.io/2018/09/08/multichain-experiment/10.png">
<meta property="og:image" content="http://billystudio.github.io/2018/09/08/multichain-experiment/11.png">
<meta property="og:image" content="http://billystudio.github.io/2018/09/08/multichain-experiment/12.png">
<meta property="og:image" content="http://billystudio.github.io/2018/09/08/multichain-experiment/13.png">
<meta property="og:image" content="http://billystudio.github.io/2018/09/08/multichain-experiment/14.png">
<meta property="og:image" content="http://billystudio.github.io/2018/09/08/multichain-experiment/15.png">
<meta property="og:image" content="http://billystudio.github.io/2018/09/08/multichain-experiment/listpermissions-issue.png">
<meta property="og:image" content="http://billystudio.github.io/2018/09/08/multichain-experiment/newaddress.png">
<meta property="og:image" content="http://billystudio.github.io/2018/09/08/multichain-experiment/listunspent.png">
<meta property="og:image" content="http://billystudio.github.io/2018/09/08/multichain-experiment/gettxout.png">
<meta property="og:image" content="http://billystudio.github.io/2018/09/08/multichain-experiment/16.png">
<meta property="og:image" content="http://billystudio.github.io/2018/09/08/multichain-experiment/workflow.png">
<meta property="og:updated_time" content="2020-10-09T08:29:52.353Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Shellchain experiment">
<meta name="twitter:description" content="Basic experiment docs">
<meta name="twitter:image" content="http://billystudio.github.io/2018/09/08/multichain-experiment/1.png">





  
  
  <link rel="canonical" href="http://BillyStudio.github.io/2018/09/08/multichain-experiment/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Shellchain experiment | Shane's Blog</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-right page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Shane's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>About</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>Tags</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>Categories</a>

  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://BillyStudio.github.io/2018/09/08/multichain-experiment/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Shane Wang">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shane's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Shellchain experiment

              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-09-08 15:32:02" itemprop="dateCreated datePublished" datetime="2018-09-08T15:32:02+08:00">2018-09-08</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2020-10-09 16:29:52" itemprop="dateModified" datetime="2020-10-09T16:29:52+08:00">2020-10-09</time>
              </span>
            
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/JuliuSC项目/" itemprop="url" rel="index"><span itemprop="name">JuliuSC项目</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          <br>
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
              
                <span class="post-meta-item-text">Symbols count in article: </span>
              
              <span title="Symbols count in article"></span>
            </span>
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
              
                <span class="post-meta-item-text">Reading time &asymp;</span>
              
              <span title="Reading time"></span>
            </span>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>Basic experiment docs <a id="more"></a></p>
<h1 id="Download-and-install"><a href="#Download-and-install" class="headerlink" title="Download and install"></a>Download and install</h1><p><a href="https://gitlab.com/echoyang/JoToChain" target="_blank" rel="noopener">https://gitlab.com/echoyang/JoToChain</a></p>
<p>项目总代码量约17万行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./autogen.sh</span><br><span class="line">./configure CFLAGS=&quot;-g -O0&quot; CXXFLAGS=&quot;-g -O0&quot; JFALGS=&quot;-g -O0&quot; FFLAGS=&quot;-g -O0&quot; CPPFLAGS=&quot;-g -O0&quot;</span><br><span class="line">make -j2</span><br></pre></td></tr></table></figure>
<h1 id="Experiment-1-单机实验"><a href="#Experiment-1-单机实验" class="headerlink" title="Experiment 1: 单机实验"></a>Experiment 1: 单机实验</h1><h3 id="start"><a href="#start" class="headerlink" title="start"></a>start</h3><p>创建一条新链，这里的链名为chain1：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsd@ubuntu_1:~$ multichain-util create chain1</span><br></pre></td></tr></table></figure></p>
<p>查看链初始化数据，启动链<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wsd@ubuntu_1:~$ cat ~/.shellchain/chain1/params.dat</span><br><span class="line">wsd@ubuntu_1:~$ multichaind chain1 -daemon</span><br></pre></td></tr></table></figure></p>
<p><img src="1.png" alt="multichaind chain1 -daemon"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsd@ubuntu_2:~$ multichaind chain1@192.168.122.168:2911</span><br></pre></td></tr></table></figure>
<p><img src="2.png" alt="second server first try"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wsd@ubuntu_1:~$ multichain-cli chain1 grant 1R6jUNxTqx6bJetkv5ZkLXLub1nsNwC95gurf6 connect</span><br><span class="line">wsd@ubuntu_2:~$ multichaind chain1 -daemon</span><br></pre></td></tr></table></figure>
<p><img src="3.png" alt="second try is ok after server 1 grants the previlege"></p>
<p>In case that the interactive mode of multichain-cli doesn’t support backspace, you can wrap the cli command with <code>multichain-cli chain1</code>.</p>
<h3 id="Streams-流"><a href="#Streams-流" class="headerlink" title="Streams: 流"></a>Streams: 流</h3><p>流可以用来存储和传递一般信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create stream stream1 true</span><br></pre></td></tr></table></figure>
<p>发布一个内容项上去，口令为 key1 （注意内容格式必须为16进制串，不然会报错：-8，Item data should be hexadecimal string）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">publish stream1 key1 1234abcd</span><br></pre></td></tr></table></figure></p>
<p>返回的是交易ID</p>
<p>检查该链上所有的流<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">liststreams</span><br></pre></td></tr></table></figure></p>
<p>至少可以看到stream1和默认的root两个流</p>
<p>订阅stream1：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">liststreamitems stream1</span><br><span class="line">subscribe stream1</span><br><span class="line">liststreamitems stream1</span><br></pre></td></tr></table></figure></p>
<p>继续发布一些内容项到流：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">publish stream1 key1 1234567890</span><br><span class="line">publish stream1 key1 abcdef</span><br></pre></td></tr></table></figure></p>
<p>获取流中的内容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">liststreamitems stream1 # should show 3 items</span><br></pre></td></tr></table></figure></p>
<p>You should see 3 items in the output because the first server has published two strings to key1, and published one string to key2.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsd@ubuntu_1:~$ multichain-cli chain1 liststreamkeys stream1 # 2 keys</span><br></pre></td></tr></table></figure>
<p><img src="4.png" alt></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wsd@ubuntu_1:~$ multichain-cli chain1 liststreamkeyitems stream1 key1 # 2 items with the key</span><br><span class="line">wsd@ubuntu_1:~$ multichain-cli chain1 liststreampublishers stream1 # 2 publishers: first server and second server</span><br></pre></td></tr></table></figure>
<p><img src="5.png" alt="two-publishers"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsd@ubuntu_1:~$ multichain-cli chain1 liststreampublisheritems stream1 1R6jUNxTqx6bJetkv5ZkLXLub1nsNwC95gurf6 # two items by this publisher</span><br></pre></td></tr></table></figure>
<h3 id="Assets"><a href="#Assets" class="headerlink" title="Assets"></a>Assets</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsd@ubuntu_1:~$ multichain-cli chain1 listpermissions issue</span><br></pre></td></tr></table></figure>
<p><img src="6.png" alt="permissions-to-create-assets"></p>
<p>copy the address in the list so that an asset with 1000 units can be created on this node.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wsd@ubuntu_1:~$ multichain-cli chain1 issue 1LWwPw3x9ocBkqTLkFGdqJqK3y6S8T3aLc7ZMg asset1 1000 0.01</span><br><span class="line">wsd@ubuntu_1:~$ multichain-cli chain1 listassets</span><br></pre></td></tr></table></figure></p>
<p>On both servers, you can verify asset1.<br><img src="7.png" alt="asset1"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wsd@ubuntu_1:~$ multichain-cli chain1 gettotalbalances</span><br><span class="line">wsd@ubuntu_2:~$ multichain-cli chain1 gettotalbalances</span><br></pre></td></tr></table></figure>
<p><img src="8.png" alt="server-1-balance"><br><img src="9.png" alt="server-2-balance"></p>
<p>If the addresses are not enough( &lt;= 2), run <code>getnewaddress</code> to create new address for receiving assets:<br><img src="getnewaddress.png" alt="getnewaddress"><br>(If multiple addresses are displayed, use the getaddresses true command to see which addresses belong to the local wallet.)</p>
<p>Now we’re going to build a new transaction which sends some of the newly created assets from the current holding addresses to the newly created addresses:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./src/multichain-cli chain1 listunspent 0 9999 &apos;[&quot;15dCVacyUcLD22yX3EeoYAecfwqdRZhfedTPT7&quot;]&apos;</span><br></pre></td></tr></table></figure></p>
<p>Now try to send 50 units of the assets from first server’s wallet to second server’s.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsd@ubuntu_1:~$ multichain-cli chain1 sendasset 1R6jUNxTqx6bJetkv5ZkLXLub1nsNwC95gurf6 asset1 100</span><br></pre></td></tr></table></figure>
<p>An error showing ‘Destination address doesn’t have receive permission’ will appear. So it’s time to add receive permissions</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsd@ubuntu_1:~$ multichain-cli chain1 grant 1R6jUNxTqx6bJetkv5ZkLXLub1nsNwC95gurf6 receive</span><br></pre></td></tr></table></figure>
<p>try sending asset again</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsd@ubuntu_1:~$ multichain-cli chain1 sendasset 1R6jUNxTqx6bJetkv5ZkLXLub1nsNwC95gurf6 asset1 100</span><br></pre></td></tr></table></figure>
<p><img src="10.png" alt="send-asset"></p>
<p>Now check the asset balances on each server, including transactions with zero confirmations.</p>
<p><img src="11.png" alt="balance-on-first-server"><br><img src="12.png" alt="balance-on-second-server"></p>
<p>You can also view the transaction on each node and see how it affected their balances:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wsd@ubuntu_1:~$ multichain-cli chain1 listwallettransactions 1</span><br><span class="line">wsd@ubuntu_2:~$ multichain-cli chain1 listwallettransactions 1</span><br></pre></td></tr></table></figure>
<h3 id="Issuing-assets"><a href="#Issuing-assets" class="headerlink" title="Issuing assets"></a>Issuing assets</h3><p>发布资产</p>
<h3 id="Combining-assets-and-streams-流与资产的结合"><a href="#Combining-assets-and-streams-流与资产的结合" class="headerlink" title="Combining assets and streams: 流与资产的结合"></a>Combining assets and streams: 流与资产的结合</h3><p>本部分将创建一笔125单位的转账交易，并写入附带信息到流中。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsd@ubuntu_1:~$ multichain-cli chain1 sendwithdata 1R6jUNxTqx6bJetkv5ZkLXLub1nsNwC95gurf6 &apos;&#123;&quot;asset1&quot;:125&#125;&apos; &apos;&#123;&quot;for&quot;:&quot;stream1&quot;,&quot;key&quot;:&quot;transfer&quot;,&quot;data&quot;:&quot;486921&quot;&#125;&apos;</span><br></pre></td></tr></table></figure>
<p><img src="13.png" alt="transaction-id"></p>
<p>Now this transaction can be examined on the second server as below:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsd@ubuntu_2:~$ multichain-cli chain1 getwallettransaction 60e98d2eb2133e1757af056e99207255a00f0d4845e6451e319774dafe20b560</span><br></pre></td></tr></table></figure>
<p>In the output from this command, you should see the balance field showing the incoming “qty” is 125 units of asset1 and the items field containing the stream item that was added. You can also view this item directly within the stream:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wsd@ubuntu_1:~$ multichain-cli chain1 liststreamitems stream1</span><br><span class="line">wsd@ubuntu_2:~$ multichain-cli chain1 liststreamitems stream1</span><br></pre></td></tr></table></figure>
<p><img src="14.png" alt="list-streamitem-stream1-on-first-server"><br><img src="15.png" alt="list-streamitem-stream1-on-second-server"></p>
<h3 id="Raw-transactions-原始交易"><a href="#Raw-transactions-原始交易" class="headerlink" title="Raw transactions: 原始交易"></a>Raw transactions: 原始交易</h3><p>查看有授权资格的账户：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">listpermissions issue</span><br></pre></td></tr></table></figure></p>
<p>(If multiple addresses are displayed, use the getaddresses true command to see which addresses belong to the local wallet.)</p>
<p>创建一笔用于转账的资产<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">issue 15dCVacyUcLD22yX3EeoYAecfwqdRZhfedTPT7 asset1 100 0.1</span><br></pre></td></tr></table></figure></p>
<p>返回资产创建的交易id<br><img src="listpermissions-issue.png" alt="list accounts of issue permission"></p>
<p>创建新的地址用于转账：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getnewaddress</span><br></pre></td></tr></table></figure></p>
<p>给予新地址交易权限：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grant 1CQ9gPjQLUnebtZh73hZv7uNDx1ihtQRUxVt5L receive,send</span><br></pre></td></tr></table></figure></p>
<p>返回交易授权地址<br><img src="newaddress.png" alt="newaddress"></p>
<p>接下来我们看一看交易格式：<code>gettransaction c20cc3707c00402ba1365a49c373483b5ae55e42055e7717d65d61bfc77243df</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;amount&quot; : 0.00000000,</span><br><span class="line">    &quot;fee&quot; : 0.00000000,</span><br><span class="line">    &quot;confirmations&quot; : 6,</span><br><span class="line">    &quot;blockhash&quot; : &quot;001ceed2e7cc61a635a4bfa81a091d53d38695b5f5068102c9d5cf8513afa95c&quot;,</span><br><span class="line">    &quot;blockindex&quot; : 1,</span><br><span class="line">    &quot;blocktime&quot; : 1599743510,</span><br><span class="line">    &quot;txid&quot; : &quot;c20cc3707c00402ba1365a49c373483b5ae55e42055e7717d65d61bfc77243df&quot;,</span><br><span class="line">    &quot;walletconflicts&quot; : [</span><br><span class="line">    ],</span><br><span class="line">    &quot;valid&quot; : true,</span><br><span class="line">    &quot;time&quot; : 1599743493,</span><br><span class="line">    &quot;timereceived&quot; : 1599743493,</span><br><span class="line">    &quot;details&quot; : [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;account&quot; : &quot;&quot;,</span><br><span class="line">            &quot;address&quot; : &quot;1CQ9gPjQLUnebtZh73hZv7uNDx1ihtQRUxVt5L&quot;,</span><br><span class="line">            &quot;category&quot; : &quot;send&quot;,</span><br><span class="line">            &quot;amount&quot; : 0.00000000,</span><br><span class="line">            &quot;vout&quot; : 0,</span><br><span class="line">            &quot;fee&quot; : 0.00000000</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;account&quot; : &quot;&quot;,</span><br><span class="line">            &quot;address&quot; : &quot;15dCVacyUcLD22yX3EeoYAecfwqdRZhfedTPT7&quot;,</span><br><span class="line">            &quot;category&quot; : &quot;send&quot;,</span><br><span class="line">            &quot;amount&quot; : 0.00000000,</span><br><span class="line">            &quot;vout&quot; : 1,</span><br><span class="line">            &quot;fee&quot; : 0.00000000</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;account&quot; : &quot;&quot;,</span><br><span class="line">            &quot;address&quot; : &quot;1CQ9gPjQLUnebtZh73hZv7uNDx1ihtQRUxVt5L&quot;,</span><br><span class="line">            &quot;category&quot; : &quot;receive&quot;,</span><br><span class="line">            &quot;amount&quot; : 0.00000000,</span><br><span class="line">            &quot;vout&quot; : 0</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;account&quot; : &quot;&quot;,</span><br><span class="line">            &quot;address&quot; : &quot;15dCVacyUcLD22yX3EeoYAecfwqdRZhfedTPT7&quot;,</span><br><span class="line">            &quot;category&quot; : &quot;receive&quot;,</span><br><span class="line">            &quot;amount&quot; : 0.00000000,</span><br><span class="line">            &quot;vout&quot; : 1</span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    &quot;hex&quot; : &quot;0100000001013e4affbd34ee58e69c34f910ba77f9bf363577fb93bbe1a2189ed656ce2640020000006a4730440220095458a6032aa1d445500b3a1321f4e4ee58c00d267b89b1c2b3d0bb427b36cc02202b4f3020dd094055a83cf859ebe0621c2c64f2ac015cf16ea331de55e168d7a7012103be0316aba83fd1a42cee503b706072c1d0db81990d3ad5589ad56eeb407d489affffffff0200000000000000002f76a9145457615fc1c97532c1927ad664d49f373c6d6e6d88ac1473706b700600000000000000ffffffff05265a5f7500000000000000001976a9142236a285f892a2049c22dacae972fb0ecb4e2a7688ac00000000027b7d00000000&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./src/multichain-cli chain1 decoderawtransaction 0100000001013e4affbd34ee58e69c34f910ba77f9bf363577fb93bbe1a2189ed656ce2640020000006a4730440220095458a6032aa1d445500b3a1321f4e4ee58c00d267b89b1c2b3d0bb427b36cc02202b4f3020dd094055a83cf859ebe0621c2c64f2ac015cf16ea331de55e168d7a7012103be0316aba83fd1a42cee503b706072c1d0db81990d3ad5589ad56eeb407d489affffffff0200000000000000002f76a9145457615fc1c97532c1927ad664d49f373c6d6e6d88ac1473706b700600000000000000ffffffff05265a5f7500000000000000001976a9142236a285f892a2049c22dacae972fb0ecb4e2a7688ac00000000027b7d00000000</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;txid&quot; : &quot;c20cc3707c00402ba1365a49c373483b5ae55e42055e7717d65d61bfc77243df&quot;,</span><br><span class="line">    &quot;version&quot; : 1,</span><br><span class="line">    &quot;locktime&quot; : 0,</span><br><span class="line">    &quot;vin&quot; : [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;txid&quot; : &quot;4026ce56d69e18a2e1bb93fb773536bff977ba10f9349ce658ee34bdff4a3e01&quot;,</span><br><span class="line">            &quot;vout&quot; : 2,</span><br><span class="line">            &quot;scriptSig&quot; : &#123;</span><br><span class="line">                &quot;asm&quot; : &quot;30440220095458a6032aa1d445500b3a1321f4e4ee58c00d267b89b1c2b3d0bb427b36cc02202b4f3020dd094055a83cf859ebe0621c2c64f2ac015cf16ea331de55e168d7a701 03be0316aba83fd1a42cee503b706072c1d0db81990d3ad5589ad56eeb407d489a&quot;,</span><br><span class="line">                &quot;hex&quot; : &quot;4730440220095458a6032aa1d445500b3a1321f4e4ee58c00d267b89b1c2b3d0bb427b36cc02202b4f3020dd094055a83cf859ebe0621c2c64f2ac015cf16ea331de55e168d7a7012103be0316aba83fd1a42cee503b706072c1d0db81990d3ad5589ad56eeb407d489a&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;sequence&quot; : 4294967295</span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    &quot;vout&quot; : [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;value&quot; : 0.00000000,</span><br><span class="line">            &quot;n&quot; : 0,</span><br><span class="line">            &quot;scriptPubKey&quot; : &#123;</span><br><span class="line">                &quot;asm&quot; : &quot;OP_DUP OP_HASH160 5457615fc1c97532c1927ad664d49f373c6d6e6d OP_EQUALVERIFY OP_CHECKSIG 73706b700600000000000000ffffffff05265a5f OP_DROP&quot;,</span><br><span class="line">                &quot;hex&quot; : &quot;76a9145457615fc1c97532c1927ad664d49f373c6d6e6d88ac1473706b700600000000000000ffffffff05265a5f75&quot;,</span><br><span class="line">                &quot;reqSigs&quot; : 1,</span><br><span class="line">                &quot;type&quot; : &quot;pubkeyhash&quot;,</span><br><span class="line">                &quot;addresses&quot; : [</span><br><span class="line">                    &quot;1CQ9gPjQLUnebtZh73hZv7uNDx1ihtQRUxVt5L&quot;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;assets&quot; : [</span><br><span class="line">            ],</span><br><span class="line">            &quot;permissions&quot; : [</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;for&quot; : null,</span><br><span class="line">                    &quot;connect&quot; : false,</span><br><span class="line">                    &quot;send&quot; : true,</span><br><span class="line">                    &quot;receive&quot; : true,</span><br><span class="line">                    &quot;create&quot; : false,</span><br><span class="line">                    &quot;issue&quot; : false,</span><br><span class="line">                    &quot;mine&quot; : false,</span><br><span class="line">                    &quot;admin&quot; : false,</span><br><span class="line">                    &quot;activate&quot; : false,</span><br><span class="line">                    &quot;startblock&quot; : 0,</span><br><span class="line">                    &quot;endblock&quot; : 4294967295,</span><br><span class="line">                    &quot;timestamp&quot; : 1599743493</span><br><span class="line">                &#125;</span><br><span class="line">            ],</span><br><span class="line">            &quot;items&quot; : [</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;value&quot; : 0.00000000,</span><br><span class="line">            &quot;n&quot; : 1,</span><br><span class="line">            &quot;scriptPubKey&quot; : &#123;</span><br><span class="line">                &quot;asm&quot; : &quot;OP_DUP OP_HASH160 2236a285f892a2049c22dacae972fb0ecb4e2a76 OP_EQUALVERIFY OP_CHECKSIG&quot;,</span><br><span class="line">                &quot;hex&quot; : &quot;76a9142236a285f892a2049c22dacae972fb0ecb4e2a7688ac&quot;,</span><br><span class="line">                &quot;reqSigs&quot; : 1,</span><br><span class="line">                &quot;type&quot; : &quot;pubkeyhash&quot;,</span><br><span class="line">                &quot;addresses&quot; : [</span><br><span class="line">                    &quot;15dCVacyUcLD22yX3EeoYAecfwqdRZhfedTPT7&quot;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;assets&quot; : [</span><br><span class="line">            ],</span><br><span class="line">            &quot;permissions&quot; : [</span><br><span class="line">            ],</span><br><span class="line">            &quot;items&quot; : [</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    &quot;data&quot; : [</span><br><span class="line">    ],</span><br><span class="line">    &quot;nType&quot; : 0</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>./src/multichain-cli chain1 getwallettransaction 20cc3707c00402ba1365a49c373483b5ae55e42055e7717d65d61bfc77243df</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;balance&quot; : &#123;</span><br><span class="line">        &quot;amount&quot; : 0.00000000,</span><br><span class="line">        &quot;assets&quot; : [</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;myaddresses&quot; : [</span><br><span class="line">        &quot;1CQ9gPjQLUnebtZh73hZv7uNDx1ihtQRUxVt5L&quot;,</span><br><span class="line">        &quot;15dCVacyUcLD22yX3EeoYAecfwqdRZhfedTPT7&quot;</span><br><span class="line">    ],</span><br><span class="line">    &quot;addresses&quot; : [</span><br><span class="line">    ],</span><br><span class="line">    &quot;permissions&quot; : [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;for&quot; : null,</span><br><span class="line">            &quot;connect&quot; : false,</span><br><span class="line">            &quot;send&quot; : true,</span><br><span class="line">            &quot;receive&quot; : true,</span><br><span class="line">            &quot;create&quot; : false,</span><br><span class="line">            &quot;issue&quot; : false,</span><br><span class="line">            &quot;mine&quot; : false,</span><br><span class="line">            &quot;admin&quot; : false,</span><br><span class="line">            &quot;activate&quot; : false,</span><br><span class="line">            &quot;startblock&quot; : 0,</span><br><span class="line">            &quot;endblock&quot; : 4294967295,</span><br><span class="line">            &quot;timestamp&quot; : 1599743493,</span><br><span class="line">            &quot;addresses&quot; : [</span><br><span class="line">                &quot;1CQ9gPjQLUnebtZh73hZv7uNDx1ihtQRUxVt5L&quot;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    &quot;items&quot; : [</span><br><span class="line">    ],</span><br><span class="line">    &quot;data&quot; : [</span><br><span class="line">    ],</span><br><span class="line">    &quot;confirmations&quot; : 11,</span><br><span class="line">    &quot;blockhash&quot; : &quot;001ceed2e7cc61a635a4bfa81a091d53d38695b5f5068102c9d5cf8513afa95c&quot;,</span><br><span class="line">    &quot;blockindex&quot; : 1,</span><br><span class="line">    &quot;blocktime&quot; : 1599743510,</span><br><span class="line">    &quot;txid&quot; : &quot;c20cc3707c00402ba1365a49c373483b5ae55e42055e7717d65d61bfc77243df&quot;,</span><br><span class="line">    &quot;valid&quot; : true,</span><br><span class="line">    &quot;time&quot; : 1599743493,</span><br><span class="line">    &quot;timereceived&quot; : 1599743493</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>列出该地址下 0 到 9999 范围内未被使用的资产（UTXO）：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">listunspent 0 9999 &apos;[&quot;15dCVacyUcLD22yX3EeoYAecfwqdRZhfedTPT7&quot;]&apos;</span><br></pre></td></tr></table></figure></p>
<p><img src="listunspent.png" alt="listunspent.png"></p>
<p>获取资产所在的交易id以及vout序号，通过 <code>gettxout</code> 命令再次检查：<br><img src="gettxout.png" alt="gettxout.png"></p>
<p>现在可以通过命令行创建一个转账20单位asset1的原始交易：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">createrawtransaction &apos;[&#123;&quot;txid&quot;:&quot;4026ce56d69e18a2e1bb93fb773536bff977ba10f9349ce658ee34bdff4a3e01&quot;,&quot;vout&quot;:0&#125;]&apos; &apos;&#123;&quot;1CQ9gPjQLUnebtZh73hZv7uNDx1ihtQRUxVt5L&quot;:&#123;&quot;asset1&quot;:20&#125;&#125;&apos;</span><br></pre></td></tr></table></figure></p>
<p>可以使用 <code>decoderawtransaction</code> 对得到的hex串进行解析。</p>
<p>由于每个交易的txin段和txout段要求的交易数量总数应该相等，在转出一笔20单位的out之后还需要补充一笔80单位的out字段：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">appendrawchange [hex-blob] 15dCVacyUcLD22yX3EeoYAecfwqdRZhfedTPT7</span><br></pre></td></tr></table></figure></p>
<p>执行成功后得到一串更长的hex，解析此串可以得到完整的txin、txout字段。可以继续添加一些16进制信息（如 abcd1234 ）作为data字段：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">appendrawdata [paste-longer-hex-blob] abcd1234</span><br></pre></td></tr></table></figure></p>
<h3 id="Round-robin-consensus"><a href="#Round-robin-consensus" class="headerlink" title="Round-robin consensus"></a>Round-robin consensus</h3><p>Definition for Round-robin consensus: Multiple nodes play a key role in validating and voting for transactions, doesn’t depend on a single participant for block validation.</p>
<p>In this secion we’ll start collaborative block validation between the nodes. Note that, in the case of a permissioned Multichain blockchain, consensus is based on block signature and a customizable round-robin consensus scheme, rather than proof-of-work as in bitcoin.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsd@ubuntu_1:~$ multichain-cli chain1 grant 1R6jUNxTqx6bJetkv5ZkLXLub1nsNwC95gurf6 mine</span><br></pre></td></tr></table></figure>
<p>(Even though the permission is called mine note that there is no real “mining” taking place, in the sense of proof-of-work.)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsd@ubuntu_2:~$ multichain-cli chain1 listpermissions mine</span><br></pre></td></tr></table></figure>
<p><img src="16.png" alt="list-mine-permissions"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wsd@ubuntu_1:~$ multichain-cli chain1 setruntimeparam miningturnover 1</span><br><span class="line">wsd@ubuntu_2:~$ multichain-cli chain1 setruntimeparam miningturnover 1</span><br></pre></td></tr></table></figure>
<p>Now wait for a couple of minutes, so that a few blocks are added. (This assumes you left the block time on the default of 15 seconds.) Check the creators of the last few blocks:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wsd@ubuntu_1:~$ multichain-cli chain1 listblocks -10</span><br><span class="line">wsd@ubuntu_2:~$ multichain-cli chain1 listblocks -10</span><br></pre></td></tr></table></figure>
<p>The address of the validator of each block is in the miner field of each element of the response.</p>
<h1 id="源码阅读"><a href="#源码阅读" class="headerlink" title="源码阅读"></a>源码阅读</h1><p>发布交易的函数是 SendMoneyToSeveralAddresses(addresses, nAmount,wtx, lpScript, CScript(),addresses,txInfo.formatTx(),txInfo.ntype); 几个参数的解释分别为，接收方地址列表addresses，转账数额nAmount，接收交易指针wtx，脚本解释器指针lpScript，新建脚本解释器对象CScript()，发送方地址列表addresses，传入的交易信息txInfo.formatTx()，传入的交易类型txInfo.ntype</p>
<p>获取交易ID： string txid= wtx.GetHash().GetHex();<br>获取userResult：txInfo.userResult.c_str()</p>
<pre><code>//获取使用方地址，并判断该地址是否存在以及拥有接收权力
vector&lt;CTxDestination&gt; addresses;
contractInformation txInfo = contractInformation();
//交易的部分参数初始化
CAmount nAmount=0;
CWalletTx wtx;
mc_Script *lpScript=mc_gState-&gt;m_TmpBuffers-&gt;m_RpcScript3;
lpScript-&gt;Clear();
</code></pre><p>更新multichain源仓库代码<br>shellchain.conf文件名的产生写在 chainparams/buildgenesis.cpp 里的 mc_GenerateConfFiles 函数中</p>
<p>rpc/rpchelp.cpp 里添加帮助文档<br>rpc/rpclist.cpp 里添加了cli命令和函数名的对应<br>rpc/rpcrawtransaction.cpp TxToJSON函数添加自定义交易字段到json的解析，在decoderawtransaction函数中会用到<br>rpc/rpcserver.h 中添加对于自定义交易函数的声明<br>rpc/rpcwalletutils.cpp SendMoneyToSeveralAddresses 中添加对 opcustom 的脚本解释器检查：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">std:vector&lt;CScript&gt; scriptOpReturns;</span><br><span class="line">if(scriptOpReturn.size())&#123;</span><br><span class="line">    scriptOpReturns.push_back(scriptOpReturn);</span><br><span class="line">&#125;</span><br><span class="line">if(scriptOpCustom.size())&#123;</span><br><span class="line">    scriptOpReturns.push_back(scriptOpCustom);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>rpc/rpcwalletsend.cpp 添加主体客体注册rpc函数和发送自定义交易函数<br>rpc/rpcclient.cpp vRPCConvertParams 中添加需要字符串转json的参数index，方法的第一个参数index为0</p>
<p>script/script.cpp GetOpName中和script.h opcodetype中 加入状态码 OP_CUSTOMDATA<br>script/standard.cpp IsStandardCustomData 加入对自定义脚本的检查</p>
<p>secp256k1/ecdsa_impl.h 中添加对于 256 位椭圆曲线的加解密函数，头文件在 ecdsa.h 中<br>secp256k1/ecmult_impl.h 中添加椭圆曲线点乘的操作<br>secp256k1/secp256k1.c 中添加加解密函数<br>secp256k1/tests.c 添加加解密测试</p>
<p>utils/serialize.h 中添加对于json参数的序列化和反序列化 stream 操作<br>utils/util.cpp 中添加对于 .shellchain 目录的创建</p>
<p>wallet/wallet_ismine.h 中定义 enum customdatatype<br>wallet/walletcoins.cpp 中BuildAssetTransaction函数、CreateAssetGroupingTransaction函数添加生成交易是自定义字段的处理</p>
<p>wallet/wallettxs.cpp 第 2051 行 for(i=0;i&lt;(int)tx.vout.size();i++) // Checking that tx has long OP_RETURN，此处可能需要添加对op_custom的支持,避免字段过大对性能的影响<br>    其中CustomTxNotify函数没搞清功能是啥</p>
<p>net/rest.cpp 负责提供rest接口</p>
<p>structs/amount.h CAmount 类型即 int64_t类型</p>
<p>阅读 createrawtransaction 1416-1576</p>
<h2 id="DIY"><a href="#DIY" class="headerlink" title="DIY"></a>DIY</h2><p><img src="workflow.png" alt="workflow.png"></p>
<p>再运行一次命令<br>./multichain-cli shellchain executecontract 1Ln9Tp1FCnKwSHw75BYBs74fyvp4LoaxzcHiqP addT 10<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"systemInput"</span>:&#123;</span><br><span class="line">        <span class="attr">"contractData"</span>:<span class="string">"aced00057372000f637573746f6d2e436f6e74726163745e7698d0be7e2a1a02000249000574696d65734c00046e616d657400124c6a6176612f6c616e672f537472696e673b7872001d7368656c6c436861696e2e5368656c6c436861696e436f6e7472616374e96530aec4a7108902000078700000000a7400263141633177415a41336a554833537964735435444b67697a41774e6f364d6e42437871365732"</span>,</span><br><span class="line">        <span class="attr">"fromAddress"</span>:<span class="string">"1Ac1wAZA3jUH3SydsT5DKgizAwNo6MnBCxq6W2"</span>,</span><br><span class="line">        <span class="attr">"funName"</span>:<span class="string">"addT"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"contractParams"</span>:&#123;</span><br><span class="line">        <span class="attr">"signature"</span>:<span class="string">""</span>,</span><br><span class="line">        <span class="attr">"partyForm"</span>:<span class="string">""</span>,</span><br><span class="line">        <span class="attr">"userParams"</span>:[<span class="string">"10"</span>]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="添加自定义接口contract"><a href="#添加自定义接口contract" class="headerlink" title="添加自定义接口contract"></a>添加自定义接口contract</h2><p>rpcserver.h 里声明<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">extern json_spirit::Value sendcontract(const json_spirit::Array&amp; params, bool fHelp);</span><br><span class="line">extern json_spirit::Value sendcontractfrom(const json_spirit::Array&amp; params, bool fHelp);</span><br><span class="line"></span><br><span class="line">extern json_spirit::Value getcontract(const json_spirit::Array&amp; params, bool fHelp);</span><br><span class="line">extern json_spirit::Value getcontractfrom(const json_spirit::Array&amp; params, bool fHelp);</span><br></pre></td></tr></table></figure></p>
<p>rpclist.cpp 里定义map的cli命令</p>
<p>如果需要json转移，则在 rpcclient.cpp 中的 vRPCConvertParams 中定义</p>
<p>接口测试<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sendcontract &apos;[&#123;&quot;txid&quot;:&quot;4026ce56d69e18a2e1bb93fb773536bff977ba10f9349ce658ee34bdff4a3e01&quot;,&quot;vout&quot;:0&#125;]&apos; &apos;&#123;&quot;1CQ9gPjQLUnebtZh73hZv7uNDx1ihtQRUxVt5L&quot;:&#123;&quot;asset1&quot;:20&#125;&#125;&apos; &apos;&#123;&quot;contractid&quot;:&quot;abcd1234&quot;, &quot;action&quot;:&#123;&quot;name&quot;:&quot;publishservice&quot;,&quot;args&quot;:[1]&#125;, &quot;state&quot;:&#123;&quot;data&quot;:&quot;somedata&quot;&#125;&#125;&apos;</span><br></pre></td></tr></table></figure></p>
<h3 id="根据公钥-pkey-获取地址："><a href="#根据公钥-pkey-获取地址：" class="headerlink" title="根据公钥 pkey 获取地址："></a>根据公钥 pkey 获取地址：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">info.fromAddress = CBitcoinAddress(pkey.GetID()).ToString();</span><br><span class="line">fromaddresses=ParseAddresses(info.fromAddress,false,true);</span><br><span class="line">addresses.push_back(fromaddresses[0]);</span><br></pre></td></tr></table></figure>
<h3 id="根据地址获取公钥脚本："><a href="#根据地址获取公钥脚本：" class="headerlink" title="根据地址获取公钥脚本："></a>根据地址获取公钥脚本：</h3><p>GetScriptForDestination</p>
<h3 id="根据-scriptPubKey-获取-pubkey"><a href="#根据-scriptPubKey-获取-pubkey" class="headerlink" title="根据 scriptPubKey 获取 pubkey"></a>根据 scriptPubKey 获取 pubkey</h3><h3 id="CMutableTransaction-转-CWalletTx"><a href="#CMutableTransaction-转-CWalletTx" class="headerlink" title="CMutableTransaction 转 CWalletTx"></a>CMutableTransaction 转 CWalletTx</h3><p>walletcoins.cpp 1808行： <em>static_cast&lt;CTransaction</em>&gt;(&amp;wtxNew) = CTransaction(txNew);</p>
<p>walletcoins.cpp 2743行 CreateAndCommitOptimizeTransaction 可以利用一下</p>
<h3 id="测试createcontract"><a href="#测试createcontract" class="headerlink" title="测试createcontract"></a>测试createcontract</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">wsd@ubuntu-16-LTS-Server:~/JoToChain$ ./src/multichain-cli contractchain createcontract contract_name ~/contract_path</span><br><span class="line">&#123;&quot;method&quot;:&quot;createcontract&quot;,&quot;params&quot;:[&quot;contract_name&quot;,&quot;/home/wsd/contract_path&quot;],&quot;id&quot;:&quot;68243892-1600005106&quot;,&quot;chain_name&quot;:&quot;contractchain&quot;&#125;</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    &quot;address&quot; : &quot;1DpHe374npo7eotqMpcWT3DRW7m3Gdt577QrMZ&quot;,</span><br><span class="line">    &quot;txid&quot; : &quot;91c743e88e50be7b36843a108b2316af9d549a9fb7c94fa320d5bd3e5d28dfa2&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#123;    </span><br><span class="line">    &quot;address&quot; : &quot;1P3xtepz7jubi9bgXuUkPFmq1aKwajoxjPPDbt&quot;,</span><br><span class="line">    &quot;txid&quot; : &quot;37a6156e39f50219b9868817be80ddb5425f10afe0c0878b7ea2103acc1240de&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Commit 过程中报错：Error: The transaction was rejected: 16: ConnectInputs failed: wrong-contract-deploy-output-information<br>报错： CommitTransaction() : Error: Transaction not valid: 16: ConnectInputs failed: contract-deploy-input: address or actionName is null。考虑原因可能是CreateTransaction的过程中没有加入contractInfo</p>
<p>walletcoins.cpp 1564行：txNew.info.add(Others); 存疑。是否有存在的必要？</p>
<p>multichaintx.cpp 里的 AcceptContract 函数用于 main.cpp 中，作用是再次检查合约格式，并加入到合约数据库内存池中。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">./src/multichain-cli contractchain gettransaction 91c743e88e50be7b36843a108b2316af9d549a9fb7c94fa320d5bd3e5d28dfa2</span><br><span class="line">&#123;</span><br><span class="line">    &quot;amount&quot; : 0.00000000,</span><br><span class="line">    &quot;fee&quot; : 0.00000000,</span><br><span class="line">    &quot;confirmations&quot; : 4,</span><br><span class="line">    &quot;blockhash&quot; : &quot;008abd8b88150757c1f2bdd4cd6ccdc7c829c698d0a084bcbff9685df729b890&quot;,</span><br><span class="line">    &quot;blockindex&quot; : 1,</span><br><span class="line">    &quot;blocktime&quot; : 1600222168,</span><br><span class="line">    &quot;txid&quot; : &quot;91c743e88e50be7b36843a108b2316af9d549a9fb7c94fa320d5bd3e5d28dfa2&quot;,</span><br><span class="line">    &quot;walletconflicts&quot; : [</span><br><span class="line">    ],</span><br><span class="line">    &quot;valid&quot; : true,</span><br><span class="line">    &quot;time&quot; : 1600222168,</span><br><span class="line">    &quot;timereceived&quot; : 1600222168,</span><br><span class="line">    &quot;details&quot; : [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;account&quot; : &quot;&quot;,</span><br><span class="line">            &quot;address&quot; : &quot;1DpHe374npo7eotqMpcWT3DRW7m3Gdt577QrMZ&quot;,</span><br><span class="line">            &quot;category&quot; : &quot;send&quot;,</span><br><span class="line">            &quot;amount&quot; : 0.00000000,</span><br><span class="line">            &quot;vout&quot; : 0,</span><br><span class="line">            &quot;fee&quot; : 0.00000000</span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    &quot;hex&quot; : &quot;...&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>解析hex<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">./src/multichain-cli contractchain decoderawtransaction 010000000172e4398b34b340c2d369c53bab6bd81bb3b2f2312ce5ffdfdab510216296f0b6000000006a473044022014153ed4e56ca6d2eeed9a58357fca9f35b3e39b70a949b771b7b8f752fdbab202206c51bf6af4120f1c32430bd10fe17b034d5f7fc7eabb66bcf4b39a6ed5d143530121027f51366ead7860f7a76ec288dcefa2c1af3b1e649f548a2d3999e73da1f5f6c0ffffffff737b2261646472657373223a2231447048653337346e706f37656f74714d7063575433445257376d3347647435373751724d5a222c2274786964223a22222c22616374696f6e4e616d65223a225f696e6974222c22616374696f6e506172616d73223a22222c227061727479536967223a22227d0200000000000000001976a9145ed1c347df506af7d9cb66877bc2b2f58789909288ac027b7d00000000000000001976a914a06beee2be7d64b78fe0af0fa3e22ac64a85ec3888ac667b22636f6e747261637444617461223a22222c2270617274795075626b6579223a22303262393564633664623037333363336264373562653164353938343730626439666463336330303465333938316539323435316138353535313163343964326166227d0000000064000000</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    &quot;txid&quot; : &quot;91c743e88e50be7b36843a108b2316af9d549a9fb7c94fa320d5bd3e5d28dfa2&quot;,</span><br><span class="line">    &quot;version&quot; : 1,</span><br><span class="line">    &quot;locktime&quot; : 0,</span><br><span class="line">    &quot;vin&quot; : [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;txid&quot; : &quot;b6f096622110b5dadfffe52c31f2b2b31bd86bab3bc569d3c240b3348b39e472&quot;,</span><br><span class="line">            &quot;vout&quot; : 0,</span><br><span class="line">            &quot;scriptSig&quot; : &#123;</span><br><span class="line">                &quot;asm&quot; : &quot;3044022014153ed4e56ca6d2eeed9a58357fca9f35b3e39b70a949b771b7b8f752fdbab202206c51bf6af4120f1c32430bd10fe17b034d5f7fc7eabb66bcf4b39a6ed5d1435301 027f51366ead7860f7a76ec288dcefa2c1af3b1e649f548a2d3999e73da1f5f6c0&quot;,</span><br><span class="line">                &quot;hex&quot; : &quot;473044022014153ed4e56ca6d2eeed9a58357fca9f35b3e39b70a949b771b7b8f752fdbab202206c51bf6af4120f1c32430bd10fe17b034d5f7fc7eabb66bcf4b39a6ed5d143530121027f51366ead7860f7a76ec288dcefa2c1af3b1e649f548a2d3999e73da1f5f6c0&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;vin_contract&quot; : &#123;</span><br><span class="line">                &quot;address&quot; : &quot;1DpHe374npo7eotqMpcWT3DRW7m3Gdt577QrMZ&quot;,</span><br><span class="line">                &quot;txid&quot; : &quot;&quot;,</span><br><span class="line">                &quot;actionName&quot; : &quot;_init&quot;,</span><br><span class="line">                &quot;actionParams&quot; : &quot;&quot;,</span><br><span class="line">                &quot;partySig&quot; : &quot;&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;sequence&quot; : 4294967295</span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    &quot;vout&quot; : [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;value&quot; : 0.00000000,</span><br><span class="line">            &quot;n&quot; : 0,</span><br><span class="line">            &quot;scriptPubKey&quot; : &#123;</span><br><span class="line">                &quot;asm&quot; : &quot;OP_DUP OP_HASH160 5ed1c347df506af7d9cb66877bc2b2f587899092 OP_EQUALVERIFY OP_CHECKSIG&quot;,</span><br><span class="line">                &quot;hex&quot; : &quot;76a9145ed1c347df506af7d9cb66877bc2b2f58789909288ac&quot;,</span><br><span class="line">                &quot;reqSigs&quot; : 1,</span><br><span class="line">                &quot;type&quot; : &quot;pubkeyhash&quot;,</span><br><span class="line">                &quot;addresses&quot; : [</span><br><span class="line">                    &quot;1DpHe374npo7eotqMpcWT3DRW7m3Gdt577QrMZ&quot;</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;value&quot; : 0.00000000,</span><br><span class="line">            &quot;n&quot; : 1,</span><br><span class="line">            &quot;scriptPubKey&quot; : &#123;</span><br><span class="line">                &quot;asm&quot; : &quot;OP_DUP OP_HASH160 a06beee2be7d64b78fe0af0fa3e22ac64a85ec38 OP_EQUALVERIFY OP_CHECKSIG&quot;,</span><br><span class="line">                &quot;hex&quot; : &quot;76a914a06beee2be7d64b78fe0af0fa3e22ac64a85ec3888ac&quot;,</span><br><span class="line">                &quot;reqSigs&quot; : 1,</span><br><span class="line">                &quot;type&quot; : &quot;pubkeyhash&quot;,</span><br><span class="line">                &quot;addresses&quot; : [</span><br><span class="line">                    &quot;1NgYPRT6AQjSgRsiShStsiWsbfPQ15sugh3bXS&quot;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;vout_contract&quot; : &#123;</span><br><span class="line">                &quot;contractData&quot; : &quot;&quot;,</span><br><span class="line">                &quot;partyPubkey&quot; : &quot;02b95dc6db0733c3bd75be1d598470bd9fdc3c004e3981e92451a855511c49d2af&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    &quot;nType&quot; : 100</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="测试-callcontract"><a href="#测试-callcontract" class="headerlink" title="测试 callcontract"></a>测试 callcontract</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">callcontract &apos;&#123;&quot;address&quot;:&quot;1XK3LDVyRStHaXThmJP1awHsrm2u8ovS8DXMbe&quot;, &quot;txid&quot;:&quot;78a50477408c82831c941e576fd41b55e7e7a73e7388375e6d576004ea12f98d&quot;, &quot;partySig&quot;:&quot;sign_partyA&quot;, &quot;actionName&quot;:&quot;publishservice&quot;, &quot;actionParams&quot;:&quot;service A, 1&quot;&#125;&apos; &apos;&#123;&quot;contractData&quot;:&quot;abcdef1234567890&quot;, &quot;partyPubkey&quot;:&quot;partyA&quot;&#125;&apos; &apos;[&#123;&quot;txid&quot;:&quot;4026ce56d69e18a2e1bb93fb773536bff977ba10f9349ce658ee34bdff4a3e01&quot;,&quot;vout&quot;:0&#125;]&apos; &apos;&#123;&quot;1CQ9gPjQLUnebtZh73hZv7uNDx1ihtQRUxVt5L&quot;:&#123;&quot;asset1&quot;:20&#125;&#125;&apos;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">callcontract &apos;&#123;&quot;address&quot;:&quot;1DpHe374npo7eotqMpcWT3DRW7m3Gdt577QrMZ&quot;, &quot;txid&quot;:&quot;91c743e88e50be7b36843a108b2316af9d549a9fb7c94fa320d5bd3e5d28dfa2&quot;, &quot;partySig&quot;:&quot;sign_partyA&quot;, &quot;actionName&quot;:&quot;publishservice&quot;, &quot;actionParams&quot;:&quot;service A, 1&quot;&#125;&apos; &apos;&#123;&quot;contractData&quot;:&quot;abcdef1234567890&quot;, &quot;partyPubkey&quot;:&quot;partyA&quot;&#125;&apos;</span><br></pre></td></tr></table></figure>
<p>报错：Insufficient funds<br>Coin selection: No unspent outputs are available. Please send a transaction, with zero amount, to this node or address first and wait for its confirmation.</p>
<p>报错原因在 wallet/wallet.cpp SelectMultiChainCoins函数中：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">int preferred_row=in_preferred_row;</span><br><span class="line">for(int attempt=0;attempt&lt;2;attempt++)</span><br><span class="line">&#123;</span><br><span class="line">    if((SelectMultiChainCoinsMinConf(nTargetValue, 1, 6, vCoins, in_map, in_amounts, in_selected_row, in_asset_row, preferred_row, setCoinsRet, nValueRet) ||</span><br><span class="line">        SelectMultiChainCoinsMinConf(nTargetValue, 1, 1, vCoins, in_map, in_amounts, in_selected_row, in_asset_row, preferred_row, setCoinsRet, nValueRet) ||</span><br><span class="line">        (bSpendZeroConfChange &amp;&amp; SelectMultiChainCoinsMinConf(nTargetValue, 0, 1, vCoins, in_map, in_amounts, in_selected_row, in_asset_row, preferred_row, setCoinsRet, nValueRet))))</span><br><span class="line">    &#123;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">    if(in_preferred_row == 0)</span><br><span class="line">    &#123;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">    preferred_row=0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">return false;</span><br></pre></td></tr></table></figure></p>
<p>该循环进行了两次attemp都没有返回true，最终返回了false</p>
<p>函数调用栈：<br>wallet/wallet.cpp 3124<br>wallet/walletcoins.cpp 1370<br>wallet/walletcoins.cpp 2187<br>wallet/walletcoins.cpp 2412<br>wallet/wallet.cpp 2691<br>rpc/rpcsmartcontract.cpp 376</p>
<p>原因：传入的 scriptPubkeys 为空？<br><code>callcontractfrom</code> 函数中加入合约公钥 scriptPubKeys.push_back(GetScriptForDestination(CBitcoinAddress(contractInfo.address).Get()));</p>
<p>wallet.cpp 2841行中会对in、out字段顺序进行洗牌算法，所以检测合约字段还应该使用 size()&gt;0 的方式，用 index=size()-1 不靠谱。</p>
<p>setFromAddresses 里没有填充值</p>
<p>测试成功结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;txid&quot; : &quot;0d33b3e18ed1bcbfabce46e10e7ec4ce60a7d3a7c686e1ff58b94c22005bbd9d&quot;,</span><br><span class="line">    &quot;version&quot; : 1,</span><br><span class="line">    &quot;locktime&quot; : 0,</span><br><span class="line">    &quot;vin&quot; : [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;txid&quot; : &quot;37a6156e39f50219b9868817be80ddb5425f10afe0c0878b7ea2103acc1240de&quot;,</span><br><span class="line">            &quot;vout&quot; : 1,</span><br><span class="line">            &quot;scriptSig&quot; : &#123;</span><br><span class="line">                &quot;asm&quot; : &quot;3045022100de1bfae39330545ca5f52455b203dde11292ff9e759425803fb429191ef7690802205d86108f9c43ce5923b78c03d4f35ac7234eca5ef6ce2cb1be26034a1fd7b6b001 027f51366ead7860f7a76ec288dcefa2c1af3b1e649f548a2d3999e73da1f5f6c0&quot;,</span><br><span class="line">                &quot;hex&quot; : &quot;483045022100de1bfae39330545ca5f52455b203dde11292ff9e759425803fb429191ef7690802205d86108f9c43ce5923b78c03d4f35ac7234eca5ef6ce2cb1be26034a1fd7b6b00121027f51366ead7860f7a76ec288dcefa2c1af3b1e649f548a2d3999e73da1f5f6c0&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;vin_contract&quot; : &#123;</span><br><span class="line">                &quot;address&quot; : &quot;1P3xtepz7jubi9bgXuUkPFmq1aKwajoxjPPDbt&quot;,</span><br><span class="line">                &quot;txid&quot; : &quot;37a6156e39f50219b9868817be80ddb5425f10afe0c0878b7ea2103acc1240de&quot;,</span><br><span class="line">                &quot;actionName&quot; : &quot;publishservice&quot;,</span><br><span class="line">                &quot;actionParams&quot; : &quot;service A, 1&quot;,</span><br><span class="line">                &quot;partySig&quot; : &quot;sign_partyA&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;sequence&quot; : 4294967295</span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    &quot;vout&quot; : [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;value&quot; : 0.00000000,</span><br><span class="line">            &quot;n&quot; : 0,</span><br><span class="line">            &quot;scriptPubKey&quot; : &#123;</span><br><span class="line">                &quot;asm&quot; : &quot;OP_DUP OP_HASH160 a32788bf5f608fe791c5104773d0caa1711b12ef OP_EQUALVERIFY OP_CHECKSIG&quot;,</span><br><span class="line">                &quot;hex&quot; : &quot;76a914a32788bf5f608fe791c5104773d0caa1711b12ef88ac&quot;,</span><br><span class="line">                &quot;reqSigs&quot; : 1,</span><br><span class="line">                &quot;type&quot; : &quot;pubkeyhash&quot;,</span><br><span class="line">                &quot;addresses&quot; : [</span><br><span class="line">                    &quot;1P3xtepz7jubi9bgXuUkPFmq1aKwajoxjPPDbt&quot;</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;value&quot; : 0.00000000,</span><br><span class="line">            &quot;n&quot; : 1,</span><br><span class="line">            &quot;scriptPubKey&quot; : &#123;</span><br><span class="line">                &quot;asm&quot; : &quot;OP_CUSTOMDATA 0061626364656631323334353637383930&quot;,</span><br><span class="line">                &quot;hex&quot; : &quot;ba110061626364656631323334353637383930&quot;,</span><br><span class="line">                &quot;type&quot; : &quot;nulldata&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;value&quot; : 0.00000000,</span><br><span class="line">            &quot;n&quot; : 2,</span><br><span class="line">            &quot;scriptPubKey&quot; : &#123;</span><br><span class="line">                &quot;asm&quot; : &quot;OP_DUP OP_HASH160 a06beee2be7d64b78fe0af0fa3e22ac64a85ec38 OP_EQUALVERIFY OP_CHECKSIG&quot;,</span><br><span class="line">                &quot;hex&quot; : &quot;76a914a06beee2be7d64b78fe0af0fa3e22ac64a85ec3888ac&quot;,</span><br><span class="line">                &quot;reqSigs&quot; : 1,</span><br><span class="line">                &quot;type&quot; : &quot;pubkeyhash&quot;,</span><br><span class="line">                &quot;addresses&quot; : [</span><br><span class="line">                    &quot;1NgYPRT6AQjSgRsiShStsiWsbfPQ15sugh3bXS&quot;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;vout_contract&quot; : &#123;</span><br><span class="line">                &quot;contractData&quot; : &quot;abcdef1234567890&quot;,</span><br><span class="line">                &quot;partyPubkey&quot; : &quot;partyA&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    &quot;nType&quot; : 4294967295</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>验证结点的合约可通过stream订阅通知</p>
<h2 id="系列测试"><a href="#系列测试" class="headerlink" title="系列测试"></a>系列测试</h2><h3 id="1"><a href="#1" class="headerlink" title="1"></a>1</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">./src/multichain-cli contractchain createcontract test_name1 test_path1</span><br><span class="line">&#123;</span><br><span class="line">    &quot;address&quot; : &quot;1J4f7mRLLbTUcq7qCdBepp14vKPGi1wUib7BgM&quot;,</span><br><span class="line">    &quot;txid&quot; : &quot;7665e9cd7aaa1e38682a36872d04f80b09c7a00f15c27f8775e44b6029325a6a&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">./src/multichain-cli contractchain callcontract &apos;&#123;&quot;address&quot;:&quot;1J4f7mRLLbTUcq7qCdBepp14vKPGi1wUib7BgM&quot;, &quot;txid&quot;:&quot;7665e9cd7aaa1e38682a36872d04f80b09c7a00f15c27f8775e44b6029325a6a&quot;, &quot;partySig&quot;:&quot;sign_partyA&quot;, &quot;actionName&quot;:&quot;publishservice&quot;, &quot;actionParams&quot;:&quot;service A, 1&quot;&#125;&apos; &apos;&#123;&quot;contractData&quot;:&quot;abcdef1234567890&quot;, &quot;partyPubkey&quot;:&quot;partyA&quot;&#125;&apos;</span><br><span class="line"></span><br><span class="line">c01076277d5e9af42b23e94d4f13e637dd828842fb315606b02175ed63031f64</span><br><span class="line"></span><br><span class="line">./src/multichain-cli contractchain grant 1J4f7mRLLbTUcq7qCdBepp14vKPGi1wUib7BgM receive,send</span><br><span class="line"></span><br><span class="line">abc4698943ce8dc7ebaacab56ea3e1836b857acce3ea858dcd704c31814a6f82</span><br><span class="line"></span><br><span class="line">./src/multichain-cli contractchain issue 1NgYPRT6AQjSgRsiShStsiWsbfPQ15sugh3bXS money 100 0.01</span><br><span class="line"></span><br><span class="line">b0aa46fb512ea4845596dbf6847cda43415e89479c80100427f59702b14bd161</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">./src/multichain-cli contractchain callcontract &apos;&#123;&quot;address&quot;:&quot;1J4f7mRLLbTUcq7qCdBepp14vKPGi1wUib7BgM&quot;, &quot;txid&quot;:&quot;c01076277d5e9af42b23e94d4f13e637dd828842fb315606b02175ed63031f64&quot;, &quot;partySig&quot;:&quot;sign_partyA&quot;, &quot;actionName&quot;:&quot;payContract&quot;, &quot;actionParams&quot;:&quot;10&quot;&#125;&apos; &apos;&#123;&quot;contractData&quot;:&quot;1234567890abcdef&quot;, &quot;partyPubkey&quot;:&quot;partyA&quot;&#125;&apos; &apos;[&#123;&quot;txid&quot;:&quot;b0aa46fb512ea4845596dbf6847cda43415e89479c80100427f59702b14bd161&quot;,&quot;vout&quot;:0&#125;]&apos; &apos;&#123;&quot;1J4f7mRLLbTUcq7qCdBepp14vKPGi1wUib7BgM&quot;:&#123;&quot;money&quot;:10&#125;&#125;&apos;</span><br><span class="line"></span><br><span class="line">e769977d0cf2d272c34ab75e93705795634447acfb7b3552c124b1d4b45e15db</span><br></pre></td></tr></table></figure>
<h3 id="2"><a href="#2" class="headerlink" title="2"></a>2</h3><ol>
<li><p>创建合约</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">./src/multichain-cli contractchain createcontract test_name2 test_path2</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    &quot;address&quot; : &quot;144Z8njQaUejZTviipyNaP5MirxVgYidW73xmK&quot;,</span><br><span class="line">    &quot;txid&quot; : &quot;b13c36a69a49d413978e1a76ceaae77a40c2b909751b3877cb27b6151346990a&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>初始化合约</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./src/multichain-cli contractchain callcontract &apos;&#123;&quot;address&quot;:&quot;144Z8njQaUejZTviipyNaP5MirxVgYidW73xmK&quot;, &quot;txid&quot;:&quot;b13c36a69a49d413978e1a76ceaae77a40c2b909751b3877cb27b6151346990a&quot;, &quot;partySig&quot;:&quot;sign_partyA&quot;, &quot;actionName&quot;:&quot;publishservice&quot;, &quot;actionParams&quot;:&quot;service A, 1&quot;&#125;&apos; &apos;&#123;&quot;contractData&quot;:&quot;abcdef1234567890&quot;, &quot;partyPubkey&quot;:&quot;partyA&quot;&#125;&apos;</span><br><span class="line"></span><br><span class="line">e14b40448c7961509f5a00abe366a804ba02e7b704d67d1d13f98a4aad61ea27</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建资产</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">./src/multichain-cli contractchain listpermissions issue</span><br><span class="line"></span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;address&quot; : &quot;1NgYPRT6AQjSgRsiShStsiWsbfPQ15sugh3bXS&quot;,</span><br><span class="line">        &quot;for&quot; : null,</span><br><span class="line">        &quot;type&quot; : &quot;issue&quot;,</span><br><span class="line">        &quot;startblock&quot; : 0,</span><br><span class="line">        &quot;endblock&quot; : 4294967295</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">./src/multichain-cli contractchain issue 1NgYPRT6AQjSgRsiShStsiWsbfPQ15sugh3bXS money2 100 0.01</span><br><span class="line"></span><br><span class="line">1298afdfd8146c2e95cbbbc524f7d69e4540a8ccc27079ab08a61c53ee924d93</span><br></pre></td></tr></table></figure>
</li>
<li><p>合约转移资产</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">./src/multichain-cli contractchain grant 144Z8njQaUejZTviipyNaP5MirxVgYidW73xmK receive,send</span><br><span class="line"></span><br><span class="line">8a7c066b680b2620671605f6de5e9560c050c65c2fdfeb21fa9eda513c23d71c</span><br><span class="line"></span><br><span class="line">./src/multichain-cli contractchain callcontract &apos;&#123;&quot;address&quot;:&quot;144Z8njQaUejZTviipyNaP5MirxVgYidW73xmK&quot;, &quot;txid&quot;:&quot;e14b40448c7961509f5a00abe366a804ba02e7b704d67d1d13f98a4aad61ea27&quot;, &quot;partySig&quot;:&quot;sign_partyA&quot;, &quot;actionName&quot;:&quot;payContract&quot;, &quot;actionParams&quot;:&quot;30&quot;&#125;&apos; &apos;&#123;&quot;contractData&quot;:&quot;1234567890abcdef&quot;, &quot;partyPubkey&quot;:&quot;partyA&quot;&#125;&apos; &apos;[&#123;&quot;txid&quot;:&quot;1298afdfd8146c2e95cbbbc524f7d69e4540a8ccc27079ab08a61c53ee924d93&quot;,&quot;vout&quot;:0&#125;]&apos; &apos;&#123;&quot;144Z8njQaUejZTviipyNaP5MirxVgYidW73xmK&quot;:&#123;&quot;money2&quot;:30&#125;&#125;&apos;</span><br><span class="line"></span><br><span class="line">df6a461259f37ffff4d9625bae73c06d393aea11a738b6cfe02a796b81f2abd7</span><br></pre></td></tr></table></figure></li>
</ol>

      
    </div>

    

    
      
    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      
        
          
        
        <div class="post-tags">
          
            <a href="/tags/Smart-Contracts/" rel="tag"># Smart Contracts</a>
          
            <a href="/tags/Blockchain/" rel="tag"># Blockchain</a>
          
            <a href="/tags/Shellchain/" rel="tag"># Shellchain</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/09/07/Sep-7th-PAT-1057/" rel="next" title="PAT 真题 | 1057 Stack">
                <i class="fa fa-chevron-left"></i> PAT 真题 | 1057 Stack
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/09/15/Sep-15th-PAT-Werewolf-simple-version/" rel="prev" title="PAT 真题 | 1148 Werewolf - Simple version">
                PAT 真题 | 1148 Werewolf - Simple version <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="gitalk-container">
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Shane Wang</p>
              <div class="site-description motion-element" itemprop="description"></div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives">
                
                    <span class="site-state-item-count">139</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              

              
            </nav>
          

          

          

          

          

          
          

          
        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Download-and-install"><span class="nav-number">1.</span> <span class="nav-text">Download and install</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Experiment-1-单机实验"><span class="nav-number">2.</span> <span class="nav-text">Experiment 1: 单机实验</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#start"><span class="nav-number">2.0.1.</span> <span class="nav-text">start</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Streams-流"><span class="nav-number">2.0.2.</span> <span class="nav-text">Streams: 流</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Assets"><span class="nav-number">2.0.3.</span> <span class="nav-text">Assets</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Issuing-assets"><span class="nav-number">2.0.4.</span> <span class="nav-text">Issuing assets</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Combining-assets-and-streams-流与资产的结合"><span class="nav-number">2.0.5.</span> <span class="nav-text">Combining assets and streams: 流与资产的结合</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Raw-transactions-原始交易"><span class="nav-number">2.0.6.</span> <span class="nav-text">Raw transactions: 原始交易</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Round-robin-consensus"><span class="nav-number">2.0.7.</span> <span class="nav-text">Round-robin consensus</span></a></li></ol></li></ol><li class="nav-item nav-level-1"><a class="nav-link" href="#源码阅读"><span class="nav-number">3.</span> <span class="nav-text">源码阅读</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#DIY"><span class="nav-number">3.1.</span> <span class="nav-text">DIY</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#添加自定义接口contract"><span class="nav-number">3.2.</span> <span class="nav-text">添加自定义接口contract</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#根据公钥-pkey-获取地址："><span class="nav-number">3.2.1.</span> <span class="nav-text">根据公钥 pkey 获取地址：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#根据地址获取公钥脚本："><span class="nav-number">3.2.2.</span> <span class="nav-text">根据地址获取公钥脚本：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#根据-scriptPubKey-获取-pubkey"><span class="nav-number">3.2.3.</span> <span class="nav-text">根据 scriptPubKey 获取 pubkey</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CMutableTransaction-转-CWalletTx"><span class="nav-number">3.2.4.</span> <span class="nav-text">CMutableTransaction 转 CWalletTx</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#测试createcontract"><span class="nav-number">3.2.5.</span> <span class="nav-text">测试createcontract</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#测试-callcontract"><span class="nav-number">3.2.6.</span> <span class="nav-text">测试 callcontract</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#系列测试"><span class="nav-number">3.3.</span> <span class="nav-text">系列测试</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1"><span class="nav-number">3.3.1.</span> <span class="nav-text">1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2"><span class="nav-number">3.3.2.</span> <span class="nav-text">2</span></a></li></ol></li></ol></li></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Shane Wang</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
    <span title="Symbols count total"></span>
  

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    
    <span title="Reading time total"></span>
  
</div>


  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.2.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>










  
  













  
  <script src="/lib/jquery/index.js?v=3.4.1"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>




  <script src="/js/utils.js?v=7.2.0"></script>

  <script src="/js/motion.js?v=7.2.0"></script>



  
  


  <script src="/js/schemes/muse.js?v=7.2.0"></script>



  
  <script src="/js/scrollspy.js?v=7.2.0"></script>
<script src="/js/post-details.js?v=7.2.0"></script>



  <script src="/js/next-boot.js?v=7.2.0"></script>

  

  

  

  

  


  
    

<script src="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>



<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css">



<script src="//cdn.jsdelivr.net/npm/js-md5@0.7.3/src/md5.min.js"></script>

<script>
  var gitalk = new Gitalk({
    clientID: '1b976dbc382f1d1e40ad',
    clientSecret: '31090c96642b800a520a7fce87050edb2bcaaeb7',
    repo: 'Blog-de-Shane',
    owner: 'BillyStudio',
    admin: ['BillyStudio'],
    id: md5(location.pathname),
    
      language: window.navigator.language || window.navigator.userLanguage,
    
    distractionFreeMode: 'true'
  });
  gitalk.render('gitalk-container');
</script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->

  


  




  

  

  
  

  
  

  


  

  

  

  

  

  

  

  

  

  

  


  

</body>
</html>
